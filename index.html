<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ladder Dynamics Calculator</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: system-ui, -apple-system, sans-serif; background: #0a0e1a; color: #e0e4ef; padding: 20px; }
.container { max-width: 1400px; margin: 0 auto; }
.header { border-bottom: 1px solid #1e2640; padding-bottom: 20px; margin-bottom: 30px; }
h1 { font-size: 28px; color: #d4a853; margin-bottom: 5px; }
.subtitle { font-size: 13px; color: #7a8299; }
.grid { display: grid; gap: 20px; }
.grid-2 { grid-template-columns: 1fr 2fr; }
.card { background: #0f1329; border: 1px solid #1e2640; border-radius: 8px; padding: 20px; }
.card-title { font-size: 12px; color: #d4a853; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; font-weight: 600; }
input, select { width: 100%; padding: 8px 12px; background: #111730; border: 1px solid #1e2640; border-radius: 4px; color: #e0e4ef; font-size: 13px; margin-top: 5px; }
input:focus, select:focus { outline: none; border-color: #d4a853; }
label { font-size: 11px; color: #7a8299; display: block; margin-bottom: 3px; }
.btn { padding: 10px 20px; background: #d4a853; color: #0a0e1a; border: none; border-radius: 4px; font-weight: 600; cursor: pointer; font-size: 14px; width: 100%; margin-top: 10px; }
.btn:hover { background: #e5b962; }
.btn-small { padding: 6px 12px; font-size: 12px; margin: 5px 5px 0 0; width: auto; display: inline-block; }
.btn-outline { background: #111730; color: #d4a853; border: 1px solid #1e2640; }
.btn-outline:hover { background: #1a2248; border-color: #d4a853; }
.btn-danger { background: #7f1d1d; color: #fca5a5; }
.btn-danger:hover { background: #991b1b; }
table { width: 100%; border-collapse: collapse; font-size: 12px; }
th { background: #111730; color: #d4a853; text-align: left; padding: 10px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid #1e2640; }
td { padding: 10px; border-bottom: 1px solid #1a2035; color: #c0c8de; }
tr:hover td { background: #111730; }
.font-mono { font-family: 'Courier New', monospace; }
.text-center { text-align: center; }
.flex { display: flex; gap: 10px; align-items: center; }
.flex-between { display: flex; justify-content: space-between; align-items: center; }
.empty { text-align: center; padding: 60px 20px; color: #4a5270; }
.grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
.stat-box { background: #111730; padding: 15px; border-radius: 6px; border: 1px solid #1e2640; text-align: center; }
.stat-label { font-size: 10px; color: #7a8299; text-transform: uppercase; margin-bottom: 5px; }
.stat-value { font-size: 18px; font-weight: bold; font-family: monospace; }
.text-amber { color: #d4a853; }
.text-green { color: #34d399; }
.text-red { color: #f87171; }
.text-yellow { color: #fbbf24; }
.text-indigo { color: #818cf8; }
.text-orange { color: #fb923c; }
.mb-3 { margin-bottom: 15px; }
.observed-list { max-height: 200px; overflow-y: auto; }
.observed-item { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
.observed-item input { margin-top: 0; }
.observed-item button { padding: 6px; background: #1e2640; border: 1px solid #1e2640; border-radius: 4px; color: #7a8299; cursor: pointer; }
.observed-item button:hover { color: #f87171; background: #7f1d1d; }
@media print {
  body { background: white; color: #1a1a1a; }
  .card { background: white; border-color: #ddd; }
  .no-print { display: none !important; }
  th { background: #f0f0f0; color: #333; }
}
</style>
</head>
<body>
<div class="container">
  <div class="header flex-between">
    <div>
      <h1>Ladder Dynamics Calculator</h1>
      <p class="subtitle">Geometric Spacing, Newtonian Ladders & Disk-Driven q-Evolution — Based on framework by D. Hughson</p>
    </div>
    <div class="no-print">
      <button class="btn btn-outline btn-small" onclick="exportCSV()">Export CSV</button>
      <button class="btn btn-outline btn-small" onclick="exportHTML()">Export HTML</button>
      <button class="btn btn-danger btn-small" onclick="clearData()">Clear Data</button>
    </div>
  </div>

  <div class="grid grid-2">
    <div class="card">
      <h2 class="card-title">System Parameters</h2>
      
      <div class="mb-3">
        <button class="btn btn-outline btn-small" onclick="loadPreset('solar')">Solar Giants</button>
        <button class="btn btn-outline btn-small" onclick="loadPreset('trappist')">TRAPPIST-1</button>
      </div>

      <div class="mb-3">
        <label>Star Mass (M☉)</label>
        <input type="number" id="starMass" value="1.0" step="0.001">
      </div>
      <div class="mb-3">
        <label>Base Radius a₀ (AU)</label>
        <input type="number" id="a0" value="5.2" step="0.001">
      </div>
      <div class="mb-3">
        <label>Geometric Factor q</label>
        <input type="number" id="q" value="1.85" step="0.01">
      </div>
      <div class="mb-3">
        <label>Number of Planets</label>
        <input type="number" id="numPlanets" value="4" min="1" max="20">
      </div>
      <div class="mb-3">
        <label>Surface Density Slope s</label>
        <input type="number" id="s" value="1.0" step="0.1">
      </div>
      <div class="mb-3">
        <label>Temperature Slope β</label>
        <input type="number" id="beta" value="0.5" step="0.1">
      </div>

      <div class="mb-3">
        <label>Observed Radii (AU) - Optional</label>
        <div id="observedList" class="observed-list"></div>
        <button class="btn btn-outline btn-small" onclick="addObserved()">+ Add Observed</button>
      </div>

      <button class="btn" onclick="calculate()">Compute All Ladders</button>
    </div>

    <div id="results">
      <div class="card empty">
        <p>Enter system parameters and click <strong class="text-amber">Compute All Ladders</strong> to see results</p>
      </div>
    </div>
  </div>
</div>

<script>
const G = 6.674e-11, M_SUN = 1.989e30, AU_TO_M = 1.496e11, YEAR_TO_S = 3.156e7;
let currentData = null;
let observedData = [];
let planetNames = [];

function loadPreset(type) {
  if (type === 'solar') {
    document.getElementById('starMass').value = 1.0;
    document.getElementById('a0').value = 5.2;
    document.getElementById('q').value = 1.85;
    document.getElementById('numPlanets').value = 4;
    observedData = [5.2, 9.6, 19.2, 30.1];
    planetNames = ['Jupiter', 'Saturn', 'Uranus', 'Neptune'];
  } else if (type === 'trappist') {
    document.getElementById('starMass').value = 0.089;
    document.getElementById('a0').value = 0.011;
    document.getElementById('q').value = 1.3;
    document.getElementById('numPlanets').value = 7;
    observedData = [0.011, 0.015, 0.021, 0.028, 0.037, 0.045, 0.062];
    planetNames = ['b', 'c', 'd', 'e', 'f', 'g', 'h'];
  }
  document.getElementById('s').value = 1.0;
  document.getElementById('beta').value = 0.5;
  renderObservedList();
}

function addObserved() {
  observedData.push('');
  planetNames.push('Planet ' + planetNames.length);
  renderObservedList();
}

function removeObserved(idx) {
  observedData.splice(idx, 1);
  planetNames.splice(idx, 1);
  renderObservedList();
}

function updateObserved(idx, val) {
  observedData[idx] = val;
}

function updateName(idx, val) {
  planetNames[idx] = val;
}

function renderObservedList() {
  const list = document.getElementById('observedList');
  list.innerHTML = observedData.map((val, i) => `
    <div class="observed-item">
      <input type="text" placeholder="Name" value="${planetNames[i]}" onchange="updateName(${i}, this.value)" style="width:100px">
      <input type="number" step="0.001" placeholder="AU" value="${val}" onchange="updateObserved(${i}, this.value)">
      <button onclick="removeObserved(${i})">✕</button>
    </div>
  `).join('');
}

function computeLadders(starMass, a0, q, numPlanets, observed) {
  const M_star = starMass * M_SUN, a0_m = a0 * AU_TO_M;
  const v0 = Math.sqrt(G * M_star / a0_m);
  const l0 = Math.sqrt(G * M_star * a0_m);
  const E0 = -G * M_star / (2 * a0_m);
  const T0 = 2 * Math.PI * Math.sqrt(Math.pow(a0_m, 3) / (G * M_star));
  const planets = [];
  
  for (let k = 0; k < numPlanets; k++) {
    const r_k_au = a0 * Math.pow(q, k);
    const v_k = v0 * Math.pow(q, -k / 2);
    const l_k = l0 * Math.pow(q, k / 2);
    const E_k = E0 * Math.pow(q, -k);
    const T_k_s = T0 * Math.pow(q, (3 * k) / 2);
    const obs_r = observed[k] ? parseFloat(observed[k]) : null;
    const dev = obs_r ? ((r_k_au - obs_r) / obs_r) * 100 : null;
    
    planets.push({
      k, radius_au: r_k_au, velocity_kms: v_k / 1000, angular_momentum: l_k,
      energy: E_k, period_days: T_k_s / 86400, period_years: T_k_s / YEAR_TO_S,
      observed_radius_au: obs_r, deviation_percent: dev
    });
  }
  
  return { starMass, a0, q, v0_kms: v0 / 1000, T0_days: T0 / 86400, T0_years: T0 / YEAR_TO_S, planets };
}

function computeDiskParams(s, beta) {
  const alpha = 0.5 - s - beta;
  const q_fixed = alpha !== 0 ? 1 / alpha : Infinity;
  let interp = '';
  if (alpha < 0) interp = 'α < 0: Outer planets migrate slower → orbits compress → q decreases → compact systems';
  else if (alpha > 0) interp = 'α > 0: Outer planets migrate faster → orbits stretch → q increases → widely spaced';
  else interp = 'α = 0: Uniform migration → no change';
  return { alpha, q_fixed, interpretation: interp, s, beta };
}

function calculate() {
  const starMass = parseFloat(document.getElementById('starMass').value);
  const a0 = parseFloat(document.getElementById('a0').value);
  const q = parseFloat(document.getElementById('q').value);
  const numPlanets = parseInt(document.getElementById('numPlanets').value);
  const s = parseFloat(document.getElementById('s').value);
  const beta = parseFloat(document.getElementById('beta').value);
  
  currentData = {
    ladder: computeLadders(starMass, a0, q, numPlanets, observedData),
    disk: computeDiskParams(s, beta)
  };
  
  renderResults();
}

function renderResults() {
  if (!currentData) return;
  const { ladder, disk } = currentData;
  
  const rows = ladder.planets.map(p => {
    const name = planetNames[p.k] || `k=${p.k}`;
    const devClass = p.deviation_percent === null ? 'text-gray' : Math.abs(p.deviation_percent) < 5 ? 'text-green' : Math.abs(p.deviation_percent) < 15 ? 'text-yellow' : 'text-red';
    return `<tr>
      <td class="text-center">${p.k}</td>
      <td>${name}</td>
      <td class="font-mono">${p.radius_au.toFixed(6)}</td>
      <td class="font-mono">${p.observed_radius_au ? p.observed_radius_au.toFixed(6) : '—'}</td>
      <td class="font-mono ${devClass}">${p.deviation_percent !== null ? p.deviation_percent.toFixed(2) + '%' : '—'}</td>
      <td class="font-mono">${p.velocity_kms.toFixed(4)}</td>
      <td class="font-mono">${p.angular_momentum.toExponential(3)}</td>
      <td class="font-mono">${p.energy.toExponential(3)}</td>
      <td class="font-mono">${p.period_days.toFixed(4)}</td>
      <td class="font-mono">${p.period_years.toFixed(6)}</td>
    </tr>`;
  }).join('');
  
  const alphaColor = disk.alpha < 0 ? 'text-indigo' : 'text-orange';
  
  document.getElementById('results').innerHTML = `
    <div class="card mb-3">
      <h2 class="card-title">Summary</h2>
      <div class="grid-4">
        <div class="stat-box"><div class="stat-label">Star Mass</div><div class="stat-value">${ladder.starMass} M☉</div></div>
        <div class="stat-box"><div class="stat-label">Base a₀</div><div class="stat-value">${ladder.a0} AU</div></div>
        <div class="stat-box"><div class="stat-label">q factor</div><div class="stat-value text-amber">${ladder.q.toFixed(4)}</div></div>
        <div class="stat-box"><div class="stat-label">Planets</div><div class="stat-value">${ladder.planets.length}</div></div>
      </div>
    </div>
    
    <div class="card mb-3">
      <h2 class="card-title">Newtonian Ladder Results</h2>
      <table>
        <thead><tr>
          <th>k</th><th>Name</th><th>r (AU)</th><th>Obs (AU)</th><th>Δ%</th>
          <th>v (km/s)</th><th>ℓ (m²/s)</th><th>E (J/kg)</th><th>T (days)</th><th>T (years)</th>
        </tr></thead>
        <tbody>${rows}</tbody>
      </table>
    </div>
    
    <div class="card">
      <h2 class="card-title">Disk Torque Analysis</h2>
      <div class="grid-4 mb-3">
        <div class="stat-box"><div class="stat-label">Density s</div><div class="stat-value">${disk.s}</div></div>
        <div class="stat-box"><div class="stat-label">Temp β</div><div class="stat-value">${disk.beta}</div></div>
        <div class="stat-box"><div class="stat-label">Migration α</div><div class="stat-value ${alphaColor}">${disk.alpha.toFixed(4)}</div></div>
        <div class="stat-box"><div class="stat-label">q_fixed</div><div class="stat-value text-amber">${isFinite(disk.q_fixed) ? disk.q_fixed.toFixed(4) : '∞'}</div></div>
      </div>
      <p style="color:#7a8299; font-size:12px; padding:10px; background:#111730; border-radius:4px;">${disk.interpretation}</p>
    </div>
  `;
}

function clearData() {
  currentData = null;
  observedData = [];
  planetNames = [];
  document.getElementById('starMass').value = 1.0;
  document.getElementById('a0').value = 5.2;
  document.getElementById('q').value = 1.85;
  document.getElementById('numPlanets').value = 4;
  document.getElementById('s').value = 1.0;
  document.getElementById('beta').value = 0.5;
  renderObservedList();
  document.getElementById('results').innerHTML = '<div class="card empty"><p>Enter system parameters and click <strong class="text-amber">Compute All Ladders</strong> to see results</p></div>';
}

function exportCSV() {
  if (!currentData) return;
  const { ladder, disk } = currentData;
  let csv = 'Ladder Dynamics Calculator - Data Export\n';
  csv += `Star Mass,${ladder.starMass}\nBase Radius a₀,${ladder.a0}\nq factor,${ladder.q}\n\n`;
  csv += `Disk Parameters\ns,${disk.s}\nβ,${disk.beta}\nα,${disk.alpha.toFixed(4)}\nq_fixed,${isFinite(disk.q_fixed) ? disk.q_fixed.toFixed(4) : '∞'}\n\n`;
  csv += 'k,Radius (AU),Observed (AU),Deviation (%),Velocity (km/s),Angular Momentum (m²/s),Energy (J/kg),Period (days),Period (years)\n';
  ladder.planets.forEach(p => {
    csv += `${p.k},${p.radius_au.toFixed(6)},${p.observed_radius_au || ''},${p.deviation_percent !== null ? p.deviation_percent.toFixed(2) : ''},${p.velocity_kms.toFixed(4)},${p.angular_momentum.toExponential(4)},${p.energy.toExponential(4)},${p.period_days.toFixed(4)},${p.period_years.toFixed(6)}\n`;
  });
  downloadFile(csv, 'ladder_dynamics.csv', 'text/csv');
}

function exportHTML() {
  downloadFile(document.documentElement.outerHTML, 'ladder_dynamics_report.html', 'text/html');
}

function downloadFile(content, filename, type) {
  const blob = new Blob([content], { type });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
}

renderObservedList();
</script>
</body>
</html>